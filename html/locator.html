<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	</head>
	<body>
		<h1>Cebu Restaurant Locator</h1>
		<div>
			<div>
				<b><label># of Restaurants found:</label><b>
				<label id="found"></label>
			</div>		
		</div>

		<!-- map container -->
		<div id="cebu_map" style="width:100%;height:500px;"></div>

		<script>
			var search = {};
			var current_location = {lat: 10.31111, lng: 123.89167 };			 
			var map_options, map, service, info_window, bounds;	
			var radius = 1000;
			var cityCircle, markers_arr = [];

			function initializeMap() {
				

				map_options= {
				   	center: new google.maps.LatLng(10.31111,123.89167),
			   		zoom:15,
			   		mapTypeId: google.maps.MapTypeId.ROADMAP,
			   		type: 'restaurant',
			   		radius: 50000
				};
			
				map = new google.maps.Map(document.getElementById("cebu_map"),map_options);


				info_window = new google.maps.InfoWindow();
		

	            // get coordinates of location clicked on the map
	            google.maps.event.addListener(map, 'click', function(event) {
	            	var new_location = {lat: event.latLng.lat(), lng: event.latLng.lng()};
	            	removeCircle();
	            	showCircle(new_location);

	            	// search for nearby establishments
	            	service = new google.maps.places.PlacesService(map);
		            service.nearbySearch({
		                location : new_location,
		                radius : radius,
		                type : [ 'restaurant' ]
		            }, callback);
					});

		        
      		}

      		// callback which calls for function that creates the marker
	        function callback(results, status) {
	        	// display # of records found
	        	document.getElementById("found").innerHTML = results.length;
	        	removeMarkers();

	         	if (status === google.maps.places.PlacesServiceStatus.OK) {
	                for (var i = 0; i < results.length; i++) {
	                    createMarker(results[i]);
	                }
	            }
	        }

	        // plots the marker in the map
            function createMarker(place) {
	            var placeLoc = place.geometry.location;
	            var marker = new google.maps.Marker({
	                map : map,
	                position : place.geometry.location
	            });

	            // check if we have a rating
	            var rating = place.rating;
	            if(rating == undefined) {
	            	rating = '';
	            }

	            // create info window content   
			    var info_window_content = '<div class="info_content">'
			        + '<h3>' + place.name + '</h3>'
			        + '<div>'
			        	+ 	'<b>Location</b>: ' + place.vicinity
			        	+ 	'<br><b>Rating</b>: ' + rating
			        	+ 	'<br>'
			        + '</div>' +
			    '</div>';

	            google.maps.event.addListener(marker, 'click', function() {console.log(place);
	                info_window.setContent(info_window_content);
	                info_window.open(map, this);
	               
	            });

	            markers_arr.push(marker);			 
			}

			 // removes the marker in the map
            function removeMarkers() {
            	if(markers_arr.length > 0) {
	            	for(var i in markers_arr) {
					   markers_arr[i].setMap(null);
					}
  				}
            }


			// adds a circle around a selected area
			function showCircle(location) {
				cityCircle = new google.maps.Circle({
		            strokeColor: '#FF0000',
		            strokeOpacity: 0.8,
		            strokeWeight: 2,
		            fillColor: '#FF0000',
		            fillOpacity: 0.35,
		            map: map,
		            center: location,
		            radius: radius
		        });
	        }

	        // removes the existing circles
	        function removeCircle() {
	        	// initially no circle around the city is set
	        	// remove circle only if it is set
	        	if(cityCircle != undefined) {
		        	cityCircle.setMap(null);
		        }
	        }
		</script>

		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdQ6z7iZymEnrZl46vWub1-6K0y6uYP6U&libraries=places&callback=initializeMap"></script>
	</body>
</html>